import{_ as k}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cmd2bEEB.js";import{d as v,x,p as w,y,a,o as i,e as r,u as n,g as E,w as f,b as t,k as p,I as b,t as c,W as C,i as N,F as V}from"./app-DP28Mstu.js";import{_ as $,a as B}from"./AppPageTitle.vue_vue_type_script_setup_true_lang-DcF92J2B.js";import{_ as U}from"./Progress.vue_vue_type_script_setup_true_lang-BtQpru0T.js";import{_ as j}from"./Button.vue_vue_type_script_setup_true_lang-BSeTgO86.js";import"./utils-BSfSTJJn.js";import"./index-Cc0VYeQ3.js";import"./createLucideIcon-D8MTOjv4.js";import"./x-Brxy_dM3.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BkZNvy2m.js";import"./usePrimitiveElement-CgzIm-HW.js";import"./Collection-Cd6XSlzf.js";import"./utils-SADwiPWk.js";import"./check-Fhtre2rC.js";import"./chevron-up-BYpCT4jK.js";import"./circle-oLloqKHD.js";import"./sun-CslGCefH.js";import"./nullish-CHIgUVhi.js";const z={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},F={class:"mt-4"},M={class:"flex items-center justify-center mt-2"},S={key:0,xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},P={key:1,class:"mr-2 text-sm"},R={key:0,class:"flex items-center justify-center mt-4"},re=v({__name:"run",props:["currentVersion","lastVersion"],setup(T){const _=[{title:"پنل مدیریت",href:"/dashboard"},{title:"به‌روز‌رسانی",href:"/update"}],g=x({}),e=w({isUpdating:!1,next_step:null,percentage:0,message:"در حال بررسی وضعیت به‌روزرسانی...",isError:!1});function d(){g.post(route("admin.update.run"),{showProgress:!1,onStart:()=>{e.isUpdating=!0},onSuccess:o=>{const{message:s,step:m,next_step:l,success:u,percentage:h}=o.props.back_response;if(e.message=s,e.next_step=l,e.percentage=h,e.step=m,u||(e.isError=!0),m==="finished"){window.location.href=route("admin.update.versions");return}l&&u&&d()},onError:o=>{e.message="خطایی رخ داد. لطفا دوباره تلاش کنید.",e.isUpdating=!1,e.isError=!0}})}return y(()=>{d()}),(o,s)=>(i(),a(V,null,[r(n(E),{title:"به‌روز‌رسانی"}),r(k,{breadcrumbs:_},{default:f(()=>[t("div",z,[r($,{icon:"refreshCw",title:"به‌روز‌رسانی",subtitle:"در این صفحه آخرین نسخه سایت روی سایت شما نصب خواهد شد."}),t("div",F,[r(n(U),{"is-error":e.isError,"model-value":e.percentage},null,8,["is-error","model-value"]),t("div",M,[e.isError?p("",!0):(i(),a("svg",S,s[1]||(s[1]=[t("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[t("path",{"stroke-dasharray":"16","stroke-dashoffset":"16",d:"M12 3c4.97 0 9 4.03 9 9"},[t("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.3s",values:"16;0"}),t("animateTransform",{attributeName:"transform",dur:"1.5s",repeatCount:"indefinite",type:"rotate",values:"0 12 12;360 12 12"})]),t("path",{"stroke-dasharray":"64","stroke-dashoffset":"64","stroke-opacity":"0.3",d:"M12 3c4.97 0 9 4.03 9 9c0 4.97 -4.03 9 -9 9c-4.97 0 -9 -4.03 -9 -9c0 -4.97 4.03 -9 9 -9Z"},[t("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"1.2s",values:"64;0"})])],-1)]))),t("span",{class:b(["mx-2 text-sm",e.isError&&"text-red-500"])},c(e.message),3),e.isError?p("",!0):(i(),a("span",P,c(e.percentage)+"%",1))]),e.isError?(i(),a("div",R,[r(n(j),{variant:"outline",onClick:s[0]||(s[0]=m=>n(C).visit(o.route("admin.update.versions")))},{default:f(()=>[r(B,{name:"chevronRight"}),s[2]||(s[2]=N(" بازگشت به صفحه لیست به‌روزرسانی ها "))]),_:1})])):p("",!0)])])]),_:1})],64))}});export{re as default};
